/**
 * Carousello
 *
 * @version 1.0
 *
 * Copyright 2013, UpSolution
 */
!function(t){"use strict";var i=function(i,s){var e=this;this.container=t(i),s=t.extend({},t.fn.carousello.defaults,"object"==typeof s&&s),this.options=s,this.widgetName=this.container.attr("class").split(" ")[0],this.btnPrev=this.container.find("."+this.widgetName+"-nav.to_prev"),this.btnNext=this.container.find("."+this.widgetName+"-nav.to_next"),this.list=this.container.find("."+this.widgetName+"-list"),this.listH=this.container.find("."+this.widgetName+"-list-h"),this.items=this.container.find("."+this.widgetName+"-item"),this.count=this.items.length,this.itemWidth=t(this.items).outerWidth(),this.itemOffset=parseInt(t(this.items).css("margin-right"),10),this.options.use3d&&(this.cssPrefix=this._get3DPrefix(),this.cssPrefix===!1&&(this.options.use3d=!1)),this.position=0,this.btnPrev.click(function(){e.slidePrev()}),this.btnNext.click(function(){e.slideNext()}),t(window).resize(function(){clearTimeout(e._resizeTimer),e._resizeTimer=setTimeout(function(){e.handleResize()},e.options.resizeDelay)}),this.options.use3d?this.container.imagesLoaded(function(){e.list.height(e.items.outerHeight()),e.handleResize()}):this.handleResize()};i.prototype={_get3DPrefix:function(){for(var t=document.createElement("div"),i=!1,s=["perspectiveProperty","WebkitPerspective","MozPerspective"],e=["","-o-","-moz-","-webkit-"],o=s.length-1;o>=0;o--)i=i?i:void 0!==t.style[s[o]];if(i){var h=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(h),t.id="test3d",document.body.appendChild(t);for(var n=0;n<e.length;n++)if(h.textContent="@media ("+e[n]+"transform-3d){#test3d{height:3px}}",3===t.offsetHeight){i=e[n];break}h.parentNode.removeChild(h),t.parentNode.removeChild(t)}return i===!0&&(i=void 0!==t.style.MozPerspective?"-moz-":void 0!==t.style.WebkitPerspective?"-webkit-":""),i},slidePrev:function(){var t=Math.max(0,this.position-this.perRow);this.slideTo(t)},slideNext:function(){var t=Math.min(this.count-this.perRow,this.position+this.perRow);this.options.use3d&&(t=this.position+this.perRow),this.slideTo(t)},slideTo:function(t){if(t!==this.position){if(this.options.use3d){var i=Math.min(Math.floor(t/this.perRow),this.groups.length-1),s=this;t=i*this.perRow,this.listH.animate({angle:-1*this.baseAngle*i},{duration:this.options.duration,easing:this.options.easing,step:function(t){t=parseInt(100*t,10)/100,s.listH.css(s.cssPrefix+"transform","translateZ(-"+s.translateZ+"px) rotateY("+t+"deg)")},queue:!1})}else this.listH.animate({left:-1*t*(this.itemWidth+this.itemOffset)},{duration:this.options.duration,easing:this.options.easing,queue:!1});this.btnPrev[0===t?"addClass":"removeClass"]("disabled"),this.btnNext[t>=this.count-this.perRow?"addClass":"removeClass"]("disabled"),this.position=t}},handleResize:function(){var i=this.container.width(),s=this.perRow,e=this;this.perRow=Math.max(1,Math.floor((i+this.itemOffset)/(this.itemWidth+this.itemOffset)));var o=this.perRow*(this.itemWidth+this.itemOffset)-this.itemOffset;if(this.list.width(o),this.options.use3d&&(void 0===s||this.perRow!==s)){this.listH.append(this.items),this.listH.children("."+this.widgetName+"-itemgroup").remove();for(var h=0,n=Math.ceil(this.count/this.perRow);n>h;h++)for(var r=t("<div/>",{"class":this.widgetName+"-itemgroup"}).appendTo(this.listH),a=0;a<this.perRow&&void 0!==this.items[h*this.perRow+a];a++)r.append(this.items[h*this.perRow+a]);this.groups=this.container.find("."+this.widgetName+"-itemgroup"),this.baseAngle=Math.min(120,360/this.groups.length),this.translateZ=Math.round(.5*o/Math.tan(Math.PI/Math.max(3,this.groups.length))),this.list.css({position:"relative",overflow:this.groups.length<5?"visible":"hidden"}).css(this.cssPrefix+"perspective","800px"),this.listH.css({position:"absolute",height:"100%",width:"100%"}).css(this.cssPrefix+"transform","rotateY(0deg) translateZ(-"+this.translateZ+"px)").css(this.cssPrefix+"transform-style","preserve-3d").css(this.cssPrefix+"perspective-origin","50% 100px"),this.list.height(this.items.outerHeight()),this.groups.css({position:"absolute",left:0,width:"100%",height:"100%"}),t.each(this.groups,function(i,s){t(s).css(e.cssPrefix+"transform","rotateY("+e.baseAngle*i+"deg) translateZ("+e.translateZ+"px)")})}void 0!==s&&this.perRow!==s&&(this.position>this.count-this.perRow&&this.slideTo(this.count-this.perRow),this.btnNext[this.position>=this.count-this.perRow?"addClass":"removeClass"]("disabled")),this.perRow>=this.count?(this.btnPrev.hide(),this.btnNext.hide()):(this.btnPrev.show(),this.btnNext.show())}},void 0===t.easing.easeOutBack&&(t.easing.easeOutBack=function(t,i,s,e,o,h){return void 0===h&&(h=1.70158),e*((i=i/o-1)*i*((h+1)*i+h)+1)+s}),void 0===t.easing.easeInOutExpo&&(t.easing.easeInOutExpo=function(t,i,s,e,o){return 0===i?s:i===o?s+e:(i/=o/2)<1?e/2*Math.pow(2,10*(i-1))+s:e/2*(-Math.pow(2,-10*--i)+2)+s}),t.fn.carousello=function(s){return this.each(function(){var e=t(this),o=e.data("carousello");o||e.data("carousello",o=new i(this,s))})},t.fn.carousello.defaults={use3d:!0,duration:500,easing:"easeInOutExpo",resizeDelay:50},t.fn.carousello.Constructor=i}(jQuery);